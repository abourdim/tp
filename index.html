<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kid Telepresence</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>

  <div class="app">
    <div class="rows-container">

      <header class="header">
        <div class="title-block">
          <img class="site-logo animated-logo" src="logo.svg" alt="WORKSHOP-DIY logo" />
          <div>
            <h1>WORKSHOP-DIY.ORG</h1>
            <div class="subtitle">Kid Telepresence</div>
          </div>
        </div>
        <div id="status" class="chip"><span class="chip-dot"></span><span>Idle</span></div>
      </header>

      <div class="row row-top">
        <!-- Live video on the LEFT -->
        <div class="col-left">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title"><span class="icon">ğŸ“¹</span> Live</div>
                <div class="card-subtitle">Other device</div>
              </div>
              <button id="remoteFsBtn" class="secondary small" disabled><span class="btn-icon">â›¶</span> Remote fullscreen</button>
            </div>

            <div id="videoStage" class="videoStage" aria-label="Remote video with local thumbnail">
              <video id="remoteVideo" class="video" autoplay playsinline></video>
              <video id="localVideo" class="videoThumb" autoplay playsinline muted></video>
            </div>
          </div>

          <!-- Room (beneath video) -->
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title"><span class="icon">ğŸ”—</span> Room</div>
                <div class="card-subtitle">Open this page on two devices, enter the same room code, then start & connect.</div>
              </div>
              <div class="status-pill" id="connPill"><span class="status-dot"></span><span>Not connected</span></div>
            </div>

            <div class="connection-section-title">Room code</div>
            <input id="roomInput" type="text" placeholder="e.g. 1234" value="demo" />

            <div class="button-row" style="flex-wrap:wrap; margin-top:10px;">
              <button id="startBtn" class="primary">ğŸ¥ Start camera</button>
              <button id="muteMicBtn" class="secondary" disabled>ğŸ”‡ Mute mic</button>
              <button id="switchCamBtn" class="secondary" disabled>ğŸ”„ Switch camera</button>
              <button id="flipBtn" class="secondary" disabled>ğŸª Mirror self</button>
              <button id="flipRemoteBtn" class="secondary" disabled>â†”ï¸ Flip remote</button>
              <button id="connectBtn" class="primary">âœ… Connect</button>
              <button id="hangupBtn" class="secondary" style="display:none">âœ‹ Hang up</button>
            </div>
          </div>
        </div>

        <!-- Controls on the RIGHT -->
        <div class="col-right">
          <!-- Game controls on the RIGHT of the video (so you can control + watch at the same time) -->
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title"><span class="icon">ğŸ®</span> Controls</div>
                <div class="card-subtitle">Virtual buttons (no physical gamepad). Press/hold to send commands to the other device.</div>
              </div>
            </div>

            <div class="controls-grid">
              <!-- D-pad + Buttons side-by-side -->
              <div class="controls-row">
                <div class="control-section dpad-section">
                  <div class="section-header">
                    <div class="section-title"><span class="section-icon">ğŸ§­</span> Dâ€‘pad</div>
                    <div class="section-subtitle">Hold to move; release to stop.</div>
                  </div>

                  <div class="dpad-wrapper" id="vpad">
                    <button class="secondary dpad-btn" data-dir="UP">â–²</button>
                    <div class="dpad-middle-row">
                      <button class="secondary dpad-btn" data-dir="LEFT">â—€</button>
                      <div class="dpad-center" aria-hidden="true"></div>
                      <button class="secondary dpad-btn" data-dir="RIGHT">â–¶</button>
                    </div>
                    <button class="secondary dpad-btn" data-dir="DOWN">â–¼</button>
                    <button class="secondary fire-btn" data-dir="STOP">â–  Stop</button>
                  </div>
                </div>

                <!-- Right side: Buttons + Send text stacked -->
                <div class="controls-side">
                  <div class="control-section buttons-section">
                    <div class="section-header">
                      <div class="section-title"><span class="section-icon">ğŸ•¹ï¸</span> Buttons</div>
                      <div class="section-subtitle">Tap to send A/B/X/Y.</div>
                    </div>

                    <div class="button-row" style="flex-wrap:wrap;">
                      <button class="secondary gp-btn" data-btn="A">A</button>
                      <button class="secondary gp-btn" data-btn="B">B</button>
                      <button class="secondary gp-btn" data-btn="X">X</button>
                      <button class="secondary gp-btn" data-btn="Y">Y</button>
                    </div>
                  </div>

                  <div class="control-section sendtext-section">
                    <div class="section-header">
                      <div class="section-title"><span class="section-icon">âœ‰ï¸</span> Send text</div>
                      <div class="section-subtitle">Useful for testing the data channel.</div>
                    </div>
                    <div class="form-row">
                      <input id="textInput" type="text" placeholder="Type textâ€¦" />
                      <button id="sendTextBtn" class="secondary">Send</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Logs at the bottom (full width) -->
      <div class="row">
        <div class="col-left" style="flex: 1 1 100%;">
          <div class="card log-card">
            <div class="card-header">
              <div>
                <div class="card-title"><span class="icon">ğŸ“</span> Logs</div>
                <div class="card-subtitle">Everything (TX/RX/system) appears here.</div>
              </div>
              <button id="clearLogsBtn" class="secondary small">ğŸ§¹ Clear</button>
            </div>
            <pre id="log" class="log" style="white-space:pre-wrap"></pre>
          </div>
        </div>
      </div>

    </div>
  </div>

  <script>
    // Load PeerJS then app logic
    const s1 = document.createElement('script');
    s1.src = 'https://unpkg.com/peerjs@1.5.4/dist/peerjs.min.js';
    s1.onload = () => {
      const s2 = document.createElement('script');
      s2.src = 'js/app.js';
      document.body.appendChild(s2);
    };
    document.body.appendChild(s1);
  </script>

</body>
</html>
