<!DOCTYPE html>

<html>
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<title>Kid Telepresence</title>
<link href="css/style.css" rel="stylesheet"/>
</head>
<body>
<div class="app">
<div class="rows-container">
<header class="header">
<div class="title-block">
<img alt="WORKSHOP-DIY logo" class="site-logo animated-logo" src="logo.svg"/>
<div>
<h1>WORKSHOP-DIY.ORG</h1>
<div class="subtitle">Kid Telepresence</div>
</div>
</div>
<div class="chip" id="status"><span class="chip-dot"></span><span>Idle</span></div>
</header>
<div class="row row-top top-row"><div class="col-left"><div class="card">
<div class="card-header">
<div>
<div class="card-title"><span class="icon">ğŸ“¹</span> Live</div>
<div class="card-subtitle">Other device</div>
</div>
<button class="secondary small" disabled="" id="remoteFsBtn"><span class="btn-icon">â›¶</span> Remote fullscreen</button>
<button class="secondary small" disabled="" id="askRemoteFsBtn" title="Ask the other device to go fullscreen"><span class="btn-icon">ğŸ“²</span> Ask remote</button>
<button class="secondary small" id="hudBtn" title="Toggle command overlay on the video"><span class="btn-icon">ğŸ‘ï¸</span> Show HUD</button>




<button class="secondary small" id="cleanCacheBtn" title="Clear storage/cache and reload"><span class="btn-icon">ğŸ§½</span> Clean cache</button>
<button class="secondary small" id="snapBtn" title="Save a PNG snapshot of the remote video"><span class="btn-icon">ğŸ“¸</span> Snapshot</button>
<button class="secondary small" id="recBtn" title="Record the remote video to WebM"><span class="btn-icon">âºï¸</span> Record</button>

</div>
<div aria-label="Remote video with local thumbnail" class="videoStage" id="videoStage">


  <div id="rxBar" class="rx-bar">RX: â€”</div>
<div id="remoteFsOverlay" class="remote-fs-overlay" aria-hidden="true" style="display:none;">
  <div class="remote-fs-panel">
    <div class="remote-fs-title">Fullscreen requested</div>
    <div class="remote-fs-subtitle">Tap below to enter fullscreen on this device.</div>
    <div class="remote-fs-actions">
      <button id="remoteFsAcceptBtn" class="primary">Go fullscreen</button>
      <button id="remoteFsDenyBtn" class="secondary">Deny</button>
    </div>
    <div class="remote-fs-hint">This prompt will hide automatically in 10s.</div>
  </div>
</div>
<video autoplay="" class="video" id="remoteVideo" playsinline=""></video>
<video autoplay="" class="videoThumb" id="localVideo" muted="" playsinline=""></video>
</div>
</div></div><div class="col-right"><div class="card">
<div class="card-header">
<div>
<div class="card-title"><span class="icon">ğŸ®</span> Controls</div>
<div class="card-subtitle">Virtual buttons (no physical gamepad). Press/hold to send commands to the other device.</div>
</div>
</div>
<div class="controls-grid">
<!-- D-pad + Buttons side-by-side -->
<div class="controls-row">
<div class="control-section dpad-section">
<div class="section-header">
<div class="section-title"><span class="section-icon">ğŸ§­</span> Dâ€‘pad</div>
<div class="section-subtitle">Hold to move; release to stop.</div>
</div>
<div class="dpad-wrapper" id="vpad">
<button class="secondary dpad-btn" data-dir="UP">â–²</button>
<div class="dpad-middle-row">
<button class="secondary dpad-btn" data-dir="LEFT">â—€</button>
<div aria-hidden="true" class="dpad-center"></div>
<button class="secondary dpad-btn" data-dir="RIGHT">â–¶</button>
</div>
<button class="secondary dpad-btn" data-dir="DOWN">â–¼</button>
<button class="secondary fire-btn" data-dir="STOP">â–  Stop</button>
</div>
</div>
<!-- Right side: Buttons + Send text stacked -->
<div class="controls-side">
<div class="control-section buttons-section">
<div class="section-header">
<div class="section-title"><span class="section-icon">ğŸ•¹ï¸</span> Buttons</div>
<div class="section-subtitle">Tap to send A/B/X/Y.</div>
</div>
<div class="button-row" style="flex-wrap:wrap;">
<button class="secondary gp-btn" data-btn="A">A</button>
<button class="secondary gp-btn" data-btn="B">B</button>
<button class="secondary gp-btn" data-btn="X">X</button>
<button class="secondary gp-btn" data-btn="Y">Y</button>
</div>
</div>
<div class="control-section sendtext-section">
<div class="section-header">
<div class="section-title"><span class="section-icon">âœ‰ï¸</span> Send text</div>
<div class="section-subtitle">Useful for testing the data channel.</div>
</div>
<div class="form-row">
<input id="textInput" placeholder="Type textâ€¦" type="text"/>
<button class="secondary" id="sendTextBtn">Send</button>
<button class="secondary" id="speakBtn">ğŸ”Š Speak</button>
</div>
</div>
</div>
</div>
</div>
</div></div></div>
<div class="row row-room-mb"><div class="col-left"><div class="card">
<div class="card-header">
<div>
<div class="card-title"><span class="icon">ğŸ”—</span> Room</div>
<div class="card-subtitle">Open this page on two devices, enter the same room code, then start &amp; connect.</div>
</div>
<div class="status-pill" id="connPill"><span class="status-dot"></span><span>Not connected</span></div>
</div>
<div class="connection-section-title">Room code</div>
<input id="roomInput" placeholder="e.g. 1234" type="text" value="demo"/>
<div class="button-row" style="flex-wrap:wrap; margin-top:10px;">
<button class="primary" id="startBtn">ğŸ¥ Start camera</button>
<button class="secondary" disabled="" id="muteMicBtn">ğŸ”‡ Mute mic</button>
<button class="secondary" disabled="" id="switchCamBtn">ğŸ”„ Switch camera</button>
<button class="secondary" disabled="" id="flipBtn">ğŸª Mirror self</button>
<button class="secondary" disabled="" id="flipRemoteBtn">â†”ï¸ Flip remote</button>
<button class="primary" id="connectBtn">âœ… Connect</button>
<button class="secondary" id="hangupBtn" style="display:none">âœ‹ Hang up</button>
</div>
</div></div><div class="col-right"><div class="card" id="microbitCard">
<div class="card-header">
<div>
<div class="card-title"><span class="icon">ğŸ§©</span> micro:bit Live Link</div>
<div class="card-subtitle">Connect and stream commands.</div>
</div>
<div class="status-pill" id="mbStatus"><span class="status-dot"></span><span>Disconnected</span></div>
</div>
<div class="button-row">
<button class="primary" id="mbConnectBtn">ğŸ”— Connect</button>
<button class="secondary" disabled="" id="mbDisconnectBtn">âœ– Disconnect</button>
<button class="secondary" disabled="" id="mbSendTestBtn">ğŸ§ª Send TEST</button>
</div>
<div class="button-row">
<button class="secondary" disabled="" id="mbBridgeOnBtn">ğŸš€ Start sending</button>
<button class="secondary" disabled="" id="mbBridgeOffBtn">ğŸ›‘ Stop</button>
<button class="secondary" disabled="" id="mbMuteMbBtn">ğŸ¤« Mute</button>
</div>
<div class="hint">
<div class="hint-title">Bridge mode</div>
<div>When enabled, commands received from the other device are forwarded to the micro:bit over BLE UART.</div>
</div>
</div></div></div>
<div class="row">
<div class="col-left" style="flex: 1 1 100%;">
<div class="card log-card">
<div class="card-header">
<div>
<div class="card-title"><span class="icon">ğŸ“</span> Logs</div>
<div class="card-subtitle">Everything (TX/RX/system) appears here.</div>
</div>
<button class="secondary small" id="clearLogsBtn">ğŸ§¹ Clear</button>
</div>
<pre class="log" id="log" style="white-space:pre-wrap"></pre>
</div>
</div>
</div>
</div>
</div>
<script>
    // Load PeerJS then app logic
    const s1 = document.createElement('script');
    s1.src = 'https://unpkg.com/peerjs@1.5.4/dist/peerjs.min.js';
    s1.onload = () => {
      const s2 = document.createElement('script');
      s2.src = 'js/app.js';
      document.body.appendChild(s2);
    };
    document.body.appendChild(s1);
  </script>
</body>
</html>
